{% extends "base.html" %}
{% block title %}MalScan • Upload{% endblock %}
{% block content %}
<h2>Upload a file</h2>

<div class="panel">
  <form method="post" enctype="multipart/form-data" class="upload-form" id="uploadForm">
    {% csrf_token %}
    <div class="form-row">
      <label class="file-label">
        <input type="file" name="file" required id="fileInput"/>
        <span id="fileName">Choose file…</span>
      </label>
      <button class="btn primary" type="submit">Analyze</button>
    </div>
    <p class="hint">Supported (MVP): <b>.apk</b>, <b>.pdf</b>.</p>
  </form>

  <div id="progressWrap" class="progress hidden">
    <div class="bar" id="progressBar"></div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function(){
  const input = document.getElementById('fileInput');
  const name = document.getElementById('fileName');
  const form = document.getElementById('uploadForm');
  const wrap = document.getElementById('progressWrap');
  const bar = document.getElementById('progressBar');

  input.addEventListener('change', () => {
    name.textContent = input.files?.[0]?.name || 'Choose file…';
  });

  form.addEventListener('submit', () => {
    wrap.classList.remove('hidden');
    let p = 0;
    const t = setInterval(() => {
      p = Math.min(95, p + Math.random()*10);
      bar.style.width = p + '%';
    }, 200);
    window.__malscan_timer = t;
  });
})();
</script>
{% endblock %}
